// Generated by CoffeeScript 2.7.0
var modulo = function(a, b) { return (+a % (b = +b) + b) % b; };

import _ from 'https://cdn.skypack.dev/lodash';

import {
  ass,
  lerp,
  param,
  range,
  hexToBase64,
  enterFullscreen
} from '../js/utils.js';

import {
  Square
} from '../js/square.js';

import {
  Button,
  ClockButton
} from '../js/button.js';

import {
  coords,
  global,
  toObjectNotation,
  toUCI
} from '../js/globals.js';

import {
  dumpState
} from '../js/globals.js';

export var Board = class Board {
  constructor(nr) {
    var i, k, len, ref, x0, x1, y0, y1, y2;
    this.click = this.click.bind(this);
    this.draw = this.draw.bind(this);
    this.littera = this.littera.bind(this);
    this.resize = this.resize.bind(this);
    this.nr = nr;
    this.squares = [];
    this.clickedSquares = [];
    this.pieces = "";
    ref = range(64);
    for (k = 0, len = ref.length; k < len; k++) {
      i = ref[k];
      ((i) => {
        return this.squares.push(new Square(this.nr, i, () => {
          return this.click(i);
        }));
      })(i);
    }
    this.buttons = [];
    x0 = round(global.mx() / 2);
    x1 = width - x0;
    y0 = round(0.20 * height);
    y1 = round(0.50 * height);
    y2 = round(0.80 * height);
    this.buttons.push(new ClockButton(x0, y1, this.nr, () => {
      return global.paused = !global.paused;
    }));
    this.buttons.push(new ClockButton(x1, y1, this.nr, () => {
      return global.paused = !global.paused;
    }));
  }

  calcMaterial() {
    var hash, k, len, piece, pieces, res;
    res = 0;
    hash = {
      '.': 0,
      'k': 0,
      'r': -5,
      'q': -9,
      'b': -3,
      'n': -3,
      'p': -1,
      'K': 0,
      'R': 5,
      'Q': 9,
      'B': 3,
      'N': 3,
      'P': 1,
      '1': 0,
      '2': 0,
      '3': 0,
      '4': 0,
      '5': 0,
      '6': 0,
      '7': 0,
      '8': 0,
      '9': 0,
      '/': 0
    };
    pieces = global.chess.fen().split(' ')[0];
    console.log(pieces);
    for (k = 0, len = pieces.length; k < len; k++) {
      piece = pieces[k];
      res += hash[piece];
    }
    console.log(res);
    return res;
  }

  click(i) {
    var col, color, csl, g, row, sq, uci;
    g = global;
    if (g.paused) {
      return;
    }
    if (this.nr === modulo(g.chess.history().length, 2)) {
      return;
    }
    col = modulo(i, 8);
    row = 7 - Math.floor(i / 8);
    sq = g.chess.board()[row][col];
    color = "wb"[modulo(g.chess.history().length, 2)];
    csl = this.clickedSquares.length;
    if (csl === 0) {
      if (sq !== null && sq.color === color) {
        return this.clickedSquares.push(i);
      }
    } else if (csl === 1) {
      if (i === this.clickedSquares[0]) {
        return this.clickedSquares = []; // kontrollera draget
      } else {
        this.clickedSquares.push(i);
        uci = toUCI(this.clickedSquares);
        // är detta ett korrekt drag? I så fall, utför det
        if (g.chess.move({
          from: uci.slice(0, 2),
          to: uci.slice(2, 4),
          promotion: 'q'
        })) {
          g.copyPGNToClipboard();
          this.clickedSquares = [];
          console.log(g.chess);
          global.audio.play();
          g.paused = false;
          if (g.chess.game_over()) {
            g.paused = true;
          }
          g.clocks[modulo(g.chess.history().length, 2)] += g.increment;
          return global.material = this.calcMaterial();
        } else {
          return this.clickedSquares.pop();
        }
      }
    }
  }

  draw() {
    var SIZE, button, i, j, k, l, len, len1, len2, m, piece, ref, ref1, ref2, ref3, ref4, ref5, sq;
    ref = this.buttons;
    for (k = 0, len = ref.length; k < len; k++) {
      button = ref[k];
      button.draw();
    }
    fill('white');
    textSize(global.size() * 0.3);
    push();
    if (this.nr === 0) {
      translate(global.mx(), global.my());
    } else {
      translate(global.mx(), global.my() + 9 * global.size());
    }
    ref1 = range(8);
    for (l = 0, len1 = ref1.length; l < len1; l++) {
      i = ref1[l];
      ref2 = range(8);
      for (m = 0, len2 = ref2.length; m < len2; m++) {
        j = ref2[m];
        piece = global.chess.board()[7 - i][j];
        sq = this.squares[i * 8 + j];
        if ((ref3 = this.clickedSquares.length) === 0 || ref3 === 2) {
          sq.draw(piece, false);
        }
        if ((ref4 = this.clickedSquares.length) === 1) {
          sq.draw(piece, i * 8 + j === this.clickedSquares[0]);
        } else if ((ref5 = this.clickedSquares.length) === 3 || ref5 === 4) {
          sq.draw(piece, i * 8 + j === this.clickedSquares[2]);
        }
      }
    }
    stroke('black');
    if (global.paused || this.nr === global.chess.history().length % 2) {
      fill(128, 128, 128, 64);
    } else {
      noFill();
    }
    SIZE = global.size();
    rect(SIZE * 4, SIZE * 4, SIZE * 8, SIZE * 8);
    pop();
    if (global.clocks[0] <= 0 || global.clocks[1] <= 0) {
      return global.paused = true;
    }
  }

  littera() {
    var SIZE, digits, i, k, len, letters, ref, results;
    SIZE = global.size();
    noStroke();
    fill('black');
    textSize(SIZE * 0.3);
    letters = false ? "hgfedcba" : "abcdefgh";
    digits = false ? "12345678" : "87654321";
    ref = range(8);
    results = [];
    for (k = 0, len = ref.length; k < len; k++) {
      i = ref[k];
      text(letters[i], SIZE * (i + 1), SIZE * 8.8);
      results.push(text(digits[i], SIZE * 0.15, SIZE * (i + 1)));
    }
    return results;
  }

  resize() {
    var button, k, len, ref, results;
    ref = this.buttons;
    results = [];
    for (k = 0, len = ref.length; k < len; k++) {
      button = ref[k];
      results.push(button.resize());
    }
    return results;
  }

};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYm9hcmQuanMiLCJzb3VyY2VSb290IjoiLi5cXCIsInNvdXJjZXMiOlsiY29mZmVlXFxib2FyZC5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLElBQUE7O0FBQUEsT0FBTyxDQUFQLE1BQUE7O0FBQ0EsT0FBQTtFQUFRLEdBQVI7RUFBWSxJQUFaO0VBQWlCLEtBQWpCO0VBQXVCLEtBQXZCO0VBQTZCLFdBQTdCO0VBQXlDLGVBQXpDO0NBQUEsTUFBQTs7QUFDQSxPQUFBO0VBQVEsTUFBUjtDQUFBLE1BQUE7O0FBQ0EsT0FBQTtFQUFRLE1BQVI7RUFBZSxXQUFmO0NBQUEsTUFBQTs7QUFDQSxPQUFBO0VBQVEsTUFBUjtFQUFlLE1BQWY7RUFBc0IsZ0JBQXRCO0VBQXVDLEtBQXZDO0NBQUEsTUFBQTs7QUFDQSxPQUFBO0VBQVEsU0FBUjtDQUFBLE1BQUE7O0FBRUEsT0FBQSxJQUFhLFFBQU4sTUFBQSxNQUFBO0VBQ04sV0FBYSxHQUFBLENBQUE7QUFDZCxRQUFBLENBQUEsRUFBQSxDQUFBLEVBQUEsR0FBQSxFQUFBLEdBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUE7UUEwQkMsQ0FBQSxZQUFBLENBQUE7UUErQkEsQ0FBQSxXQUFBLENBQUE7UUE2QkEsQ0FBQSxjQUFBLENBQUE7UUFZQSxDQUFBLGFBQUEsQ0FBQTtJQW5HYyxJQUFDLENBQUE7SUFDZCxJQUFDLENBQUEsT0FBRCxHQUFXO0lBQ1gsSUFBQyxDQUFBLGNBQUQsR0FBa0I7SUFDbEIsSUFBQyxDQUFBLE1BQUQsR0FBVTtBQUNWO0lBQUEsS0FBQSxxQ0FBQTs7TUFDSSxDQUFBLENBQUMsQ0FBRCxDQUFBLEdBQUE7ZUFBTyxJQUFDLENBQUEsT0FBTyxDQUFDLElBQVQsQ0FBYyxJQUFJLE1BQUosQ0FBVyxJQUFDLENBQUEsRUFBWixFQUFnQixDQUFoQixFQUFtQixDQUFBLENBQUEsR0FBQTtpQkFBRyxJQUFDLENBQUEsS0FBRCxDQUFPLENBQVA7UUFB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QUMsTUFBTSxDQUFDLENBQUQsQ0FBYixJQUFvQixDQUFwQixJQUF5QixNQUFNLENBQUMsTUFBTSxDQUFDLENBQUQsQ0FBYixJQUFvQixDQUFoRDthQUF1RCxNQUFNLENBQUMsTUFBUCxHQUFnQixLQUF2RTs7RUEzQk07O0VBNkJQLE9BQVUsQ0FBQSxDQUFBO0FBQ1gsUUFBQSxJQUFBLEVBQUEsTUFBQSxFQUFBLENBQUEsRUFBQSxDQUFBLEVBQUEsR0FBQSxFQUFBLE9BQUEsRUFBQSxHQUFBLEVBQUE7SUFBRSxJQUFBLEdBQU8sTUFBTSxDQUFDLElBQVAsQ0FBQTtJQUNQLFFBQUEsQ0FBQTtJQUNBLElBQUEsQ0FBSyxPQUFMO0lBQ0EsUUFBQSxDQUFTLElBQUEsR0FBSyxHQUFkO0lBQ0EsT0FBQSxHQUFhLEtBQUgsR0FBYyxVQUFkLEdBQThCO0lBQ3hDLE1BQUEsR0FBYSxLQUFILEdBQWMsVUFBZCxHQUE4QjtBQUV4QztBQUFBO0lBQUEsS0FBQSxxQ0FBQTs7TUFDQyxJQUFBLENBQUssT0FBTyxDQUFDLENBQUQsQ0FBWixFQUFnQixJQUFBLEdBQUssQ0FBQyxDQUFBLEdBQUUsQ0FBSCxDQUFyQixFQUEyQixJQUFBLEdBQUssR0FBaEM7bUJBQ0EsSUFBQSxDQUFLLE1BQU0sQ0FBQyxDQUFELENBQVgsRUFBZSxJQUFBLEdBQUssSUFBcEIsRUFBeUIsSUFBQSxHQUFLLENBQUMsQ0FBQSxHQUFFLENBQUgsQ0FBOUI7SUFGRCxDQUFBOztFQVJTOztFQVlWLE1BQVEsQ0FBQSxDQUFBO0FBQ1QsUUFBQSxNQUFBLEVBQUEsQ0FBQSxFQUFBLEdBQUEsRUFBQSxHQUFBLEVBQUE7QUFBRTtBQUFBO0lBQUEsS0FBQSxxQ0FBQTs7bUJBQ0MsTUFBTSxDQUFDLE1BQVAsQ0FBQTtJQURELENBQUE7O0VBRE87O0FBcEdGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnaHR0cHM6Ly9jZG4uc2t5cGFjay5kZXYvbG9kYXNoJ1xyXG5pbXBvcnQge2FzcyxsZXJwLHBhcmFtLHJhbmdlLGhleFRvQmFzZTY0LGVudGVyRnVsbHNjcmVlbn0gZnJvbSAnLi4vanMvdXRpbHMuanMnXHJcbmltcG9ydCB7U3F1YXJlfSBmcm9tICcuLi9qcy9zcXVhcmUuanMnXHJcbmltcG9ydCB7QnV0dG9uLENsb2NrQnV0dG9ufSBmcm9tICcuLi9qcy9idXR0b24uanMnXHJcbmltcG9ydCB7Y29vcmRzLGdsb2JhbCx0b09iamVjdE5vdGF0aW9uLHRvVUNJfSBmcm9tICcuLi9qcy9nbG9iYWxzLmpzJ1xyXG5pbXBvcnQge2R1bXBTdGF0ZX0gZnJvbSAnLi4vanMvZ2xvYmFscy5qcydcclxuXHJcbmV4cG9ydCBjbGFzcyBCb2FyZFxyXG5cdGNvbnN0cnVjdG9yOiAoQG5yKSAtPlxyXG5cdFx0QHNxdWFyZXMgPSBbXVxyXG5cdFx0QGNsaWNrZWRTcXVhcmVzID0gW11cclxuXHRcdEBwaWVjZXMgPSBcIlwiXHJcblx0XHRmb3IgaSBpbiByYW5nZSA2NFxyXG5cdFx0XHRkbyAoaSkgPT4gQHNxdWFyZXMucHVzaCBuZXcgU3F1YXJlIEBuciwgaSwgPT4gQGNsaWNrIGlcclxuXHJcblx0XHRAYnV0dG9ucyA9IFtdXHJcblxyXG5cdFx0eDAgPSByb3VuZCBnbG9iYWwubXgoKS8yXHJcblx0XHR4MSA9IHdpZHRoLSB4MFxyXG5cdFx0eTAgPSByb3VuZCAwLjIwKmhlaWdodFxyXG5cdFx0eTEgPSByb3VuZCAwLjUwKmhlaWdodFxyXG5cdFx0eTIgPSByb3VuZCAwLjgwKmhlaWdodFxyXG5cclxuXHRcdEBidXR0b25zLnB1c2ggbmV3IENsb2NrQnV0dG9uIHgwLHkxLEBuciw9PiBnbG9iYWwucGF1c2VkID0gbm90IGdsb2JhbC5wYXVzZWRcclxuXHRcdEBidXR0b25zLnB1c2ggbmV3IENsb2NrQnV0dG9uIHgxLHkxLEBuciw9PiBnbG9iYWwucGF1c2VkID0gbm90IGdsb2JhbC5wYXVzZWRcclxuXHJcblx0Y2FsY01hdGVyaWFsIDogKCkgLT5cclxuXHRcdHJlcyA9IDBcclxuXHRcdGhhc2ggPSB7Jy4nOjAsJ2snOjAsJ3InOi01LCdxJzotOSwnYic6LTMsJ24nOi0zLCdwJzotMSwnSyc6MCwnUic6NSwnUSc6OSwnQic6MywnTic6MywnUCc6MSwgJzEnOjAsJzInOjAsJzMnOjAsJzQnOjAsJzUnOjAsJzYnOjAsJzcnOjAsJzgnOjAsJzknOjAsJy8nOjB9XHRcdFxyXG5cdFx0cGllY2VzID0gZ2xvYmFsLmNoZXNzLmZlbigpLnNwbGl0KCcgJylbMF1cclxuXHRcdGNvbnNvbGUubG9nIHBpZWNlc1xyXG5cdFx0cmVzICs9IGhhc2hbcGllY2VdIGZvciBwaWVjZSBpbiBwaWVjZXNcclxuXHRcdGNvbnNvbGUubG9nIHJlc1xyXG5cdFx0cmV0dXJuIHJlc1xyXG5cclxuXHRjbGljayA6IChpKSA9PlxyXG5cdFx0ZyA9IGdsb2JhbFxyXG5cdFx0aWYgZy5wYXVzZWQgdGhlbiByZXR1cm5cclxuXHRcdGlmIEBuciA9PSBnLmNoZXNzLmhpc3RvcnkoKS5sZW5ndGggJSUgMiB0aGVuIHJldHVyblxyXG5cdFx0Y29sID0gaSAlJSA4XHJcblx0XHRyb3cgPSA3IC0gaSAvLyA4XHJcblx0XHRzcSA9IGcuY2hlc3MuYm9hcmQoKVtyb3ddW2NvbF1cclxuXHRcdGNvbG9yID0gXCJ3YlwiW2cuY2hlc3MuaGlzdG9yeSgpLmxlbmd0aCAlJSAyXSAjIGbDtnJ2w6RudGFkIGbDpHJnIHDDpSBwasOkc2VuXHJcblx0XHRjc2wgPSBAY2xpY2tlZFNxdWFyZXMubGVuZ3RoXHJcblx0XHRpZiBjc2wgPT0gMFxyXG5cdFx0XHRpZiBzcSAhPSBudWxsIGFuZCBzcS5jb2xvciA9PSBjb2xvciB0aGVuIEBjbGlja2VkU3F1YXJlcy5wdXNoIGlcclxuXHRcdGVsc2UgaWYgY3NsID09IDFcclxuXHRcdFx0aWYgaSA9PSBAY2xpY2tlZFNxdWFyZXNbMF0gIyDDpW5ncmEgb20gc2FtbWEgcnV0YVxyXG5cdFx0XHRcdEBjbGlja2VkU3F1YXJlcyA9IFtdXHJcblx0XHRcdGVsc2UgIyBrb250cm9sbGVyYSBkcmFnZXRcclxuXHRcdFx0XHRAY2xpY2tlZFNxdWFyZXMucHVzaCBpXHJcblx0XHRcdFx0dWNpID0gdG9VQ0kgQGNsaWNrZWRTcXVhcmVzXHJcblxyXG5cdFx0XHRcdCMgw6RyIGRldHRhIGV0dCBrb3JyZWt0IGRyYWc/IEkgc8OlIGZhbGwsIHV0ZsO2ciBkZXRcclxuXHRcdFx0XHRpZiBnLmNoZXNzLm1vdmUge2Zyb206dWNpLnNsaWNlKDAsMiksIHRvOnVjaS5zbGljZSgyLDQpLCBwcm9tb3Rpb246J3EnfVxyXG5cdFx0XHRcdFx0Zy5jb3B5UEdOVG9DbGlwYm9hcmQoKVxyXG5cdFx0XHRcdFx0QGNsaWNrZWRTcXVhcmVzID0gW11cclxuXHRcdFx0XHRcdGNvbnNvbGUubG9nIGcuY2hlc3NcclxuXHRcdFx0XHRcdGdsb2JhbC5hdWRpby5wbGF5KClcclxuXHRcdFx0XHRcdGcucGF1c2VkID0gZmFsc2VcclxuXHRcdFx0XHRcdGlmIGcuY2hlc3MuZ2FtZV9vdmVyKCkgdGhlbiBnLnBhdXNlZCA9IHRydWVcclxuXHRcdFx0XHRcdGcuY2xvY2tzW2cuY2hlc3MuaGlzdG9yeSgpLmxlbmd0aCAlJSAyXSArPSBnLmluY3JlbWVudFxyXG5cdFx0XHRcdFx0Z2xvYmFsLm1hdGVyaWFsID0gQGNhbGNNYXRlcmlhbCgpXHJcblx0XHRcdFx0ZWxzZVxyXG5cdFx0XHRcdFx0QGNsaWNrZWRTcXVhcmVzLnBvcCgpXHJcblxyXG5cdGRyYXcgOiA9PlxyXG5cdFx0Zm9yIGJ1dHRvbiBpbiBAYnV0dG9uc1xyXG5cdFx0XHRidXR0b24uZHJhdygpXHJcblxyXG5cdFx0ZmlsbCAnd2hpdGUnXHJcblx0XHR0ZXh0U2l6ZSBnbG9iYWwuc2l6ZSgpICogMC4zXHJcblxyXG5cdFx0cHVzaCgpXHJcblx0XHRpZiBAbnI9PTAgdGhlbiB0cmFuc2xhdGUgZ2xvYmFsLm14KCksIGdsb2JhbC5teSgpXHJcblx0XHRlbHNlIHRyYW5zbGF0ZSBnbG9iYWwubXgoKSwgZ2xvYmFsLm15KCkgKyA5ICogZ2xvYmFsLnNpemUoKVxyXG5cclxuXHRcdGZvciBpIGluIHJhbmdlIDhcclxuXHRcdFx0Zm9yIGogaW4gcmFuZ2UgOFxyXG5cdFx0XHRcdHBpZWNlID0gZ2xvYmFsLmNoZXNzLmJvYXJkKClbNy1pXVtqXVxyXG5cdFx0XHRcdHNxID0gQHNxdWFyZXNbaSo4K2pdXHJcblx0XHRcdFx0aWYgQGNsaWNrZWRTcXVhcmVzLmxlbmd0aCBpbiBbMCwyXVxyXG5cdFx0XHRcdFx0c3EuZHJhdyBwaWVjZSwgZmFsc2VcclxuXHRcdFx0XHRpZiBAY2xpY2tlZFNxdWFyZXMubGVuZ3RoIGluIFsxXVxyXG5cdFx0XHRcdFx0c3EuZHJhdyBwaWVjZSwgaSo4K2o9PUBjbGlja2VkU3F1YXJlc1swXVxyXG5cdFx0XHRcdGVsc2UgaWYgQGNsaWNrZWRTcXVhcmVzLmxlbmd0aCBpbiBbMyw0XVxyXG5cdFx0XHRcdFx0c3EuZHJhdyBwaWVjZSwgaSo4K2o9PUBjbGlja2VkU3F1YXJlc1syXVxyXG5cclxuXHRcdHN0cm9rZSAnYmxhY2snXHJcblx0XHRpZiBnbG9iYWwucGF1c2VkIG9yIEBuciA9PSBnbG9iYWwuY2hlc3MuaGlzdG9yeSgpLmxlbmd0aCUyIHRoZW4gZmlsbCAxMjgsMTI4LDEyOCw2NCBlbHNlIG5vRmlsbCgpXHJcblx0XHRTSVpFID0gZ2xvYmFsLnNpemUoKVxyXG5cdFx0cmVjdCBTSVpFKjQsU0laRSo0LFNJWkUqOCxTSVpFKjhcclxuXHRcdHBvcCgpXHJcblx0XHRpZiBnbG9iYWwuY2xvY2tzWzBdIDw9IDAgb3IgZ2xvYmFsLmNsb2Nrc1sxXSA8PSAwIHRoZW4gZ2xvYmFsLnBhdXNlZCA9IHRydWVcclxuXHJcblx0bGl0dGVyYSA6ID0+XHJcblx0XHRTSVpFID0gZ2xvYmFsLnNpemUoKVxyXG5cdFx0bm9TdHJva2UoKVxyXG5cdFx0ZmlsbCAnYmxhY2snXHJcblx0XHR0ZXh0U2l6ZSBTSVpFKjAuM1xyXG5cdFx0bGV0dGVycyA9IGlmIGZhbHNlIHRoZW4gXCJoZ2ZlZGNiYVwiIGVsc2UgXCJhYmNkZWZnaFwiXHJcblx0XHRkaWdpdHMgID0gaWYgZmFsc2UgdGhlbiBcIjEyMzQ1Njc4XCIgZWxzZSBcIjg3NjU0MzIxXCJcclxuXHJcblx0XHRmb3IgaSBpbiByYW5nZSA4XHJcblx0XHRcdHRleHQgbGV0dGVyc1tpXSxTSVpFKihpKzEpLFNJWkUqOC44XHJcblx0XHRcdHRleHQgZGlnaXRzW2ldLFNJWkUqMC4xNSxTSVpFKihpKzEpXHJcblxyXG5cdHJlc2l6ZTogPT5cclxuXHRcdGZvciBidXR0b24gaW4gQGJ1dHRvbnNcclxuXHRcdFx0YnV0dG9uLnJlc2l6ZSgpXHJcbiJdfQ==
//# sourceURL=c:\github\2023\026-chessx2\coffee\board.coffee